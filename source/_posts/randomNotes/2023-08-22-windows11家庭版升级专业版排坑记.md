---
layout: blog
title: "windows11家庭版升级专业版排坑记"
mark: 原创
background: notes
date:  2023-08-22
category: 随拾
tags:
- windows
- win11
---

### 前言
新买的笔记本预装的是win11的家庭版，虽然是正版，但是家庭版相对专业版来说，少了 Hyper-V 和一些高级功能，于是就想自己折腾下，把他换到专业版。  


### 制作PE
安装系统的第一步，首先就是制作一个PE。  
这里我选择的是系统总裁的U盘魔术师来制作PE，下载地址：https://www.sysceo.com/usm ，下载v5版本就行。 
打开U盘魔术师，制作PE有两种模式：

#### 1.U盘模式
![](QQ20230822104729.png)
这里我没有插入U盘，如果插入了U盘(移动硬盘)在选择设备那里选择你的U盘(移动硬盘)。然后全部默认点击一键制作即可。

#### 1.硬盘模式
![](QQ20230822105031.png)
选择磁盘后，点击一键制作即可。


### 下载镜像
推荐直接从官网下载镜像：https://www.microsoft.com/zh-cn/software-download/windows11  
![](QQ20230822105310.png)
选择Windows 11 (multi-edition ISO)，也就是多版本，然点下载。
![](QQ20230822105432.png)
选择语言，点击确认。
![](QQ20230822105512.png)
点击 `64-bit Download` 按钮下载。
__这里注意不要把镜像下载到C盘也就是系统盘，因为重装系统的时候会格式化那个盘。可以下载到别的硬盘或者直接下载到U盘(移动硬盘)__


### 启动PE，安装系统
_由于实际操作忘记拍照和截图了，图就先鸽了，有空再补上。。。_
重启电脑，如果是硬盘模式，电脑进入系统前就会有选项，选择 `Usm_PE` 选项进入PE系统。  
找到桌面上的安装系统程序，打开，在镜像选择那里选择之前下载好的镜像ISO文件，等待一会后在下方选择要安装的版本，这里我们选择Windows 11 专业版。然后点击安装。  
安装好了后电脑会自动重启。  


### 创建新的本地管理员用户，登录在线账号
由于新安装的系统默认是使用的内置Administrator账户，这个账户是无法登录在线账户的，需要禁用它。 

#### 创建新的本地管理员用户
邮件开始找到，找到计算器管理，进入，在本地用户和组下选择用户，然后在上面的工具栏选择操作->新用户：
![](2023-08-22-111724.png)
填写表单新增用户，取消勾选[用户下次登录时必须更改密码复选框]，点击创建：
![](2023-08-22-112007.png)
然后回到用户界面，找到刚刚新建的用户，右键选择属性：
![](2023-08-22-112213.png)
切换到隶属于选项卡，选择Administrators，点击确认。  
如果没有Administrators，点击添加按钮，然后选择高级，点击立即查找，找到Administrators后选择，然后点击确定：
![](20230822112430.png)
再次确定后，就有了Administrators用户组，选择它确定即可。

#### 禁用内置 Administrator 帐户 
> 禁用内置账户可以参考官方文档：https://learn.microsoft.com/zh-cn/windows-hardware/manufacture/desktop/enable-and-disable-the-built-in-administrator-account?view=windows-11
#### 省流操作
可使用以下任一方法来禁用内置 Administrator 帐户：
- 运行 sysprep /generalize 命令
  运行 sysprep /generalize 命令后，下次启动计算机时将禁用内置 Administrator 帐户。
- 使用 net user 命令
  运行以下命令禁用 Administrator 帐户：
  ```bat
  net user administrator /active:no
  ```
完成之后重启计算机，便可以登录在线用户了。


### 激活新的Windows系统
因为之前我们的系统是家庭版，新安装的系统是专业版，之前家庭版的密钥已经无法激活专业版了，这里就需要我们手动激活。这里我采用的是kms方式激活。
#### 方法一：去网上找别人搭建好的kms服务器激活
由于之前能用的很多kms服务器都失效了，所以这里就不贴了，自己去网上找找吧。

#### 方法二：自己搭建kms服务器激活
参考Futrime大佬的文章：[自建kms服务器激活windows](https://blog.futrime.com/zh-cn/p/%E8%87%AA%E5%BB%BAkms%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%BF%80%E6%B4%BBwindows/)

> CentOS 安装Docker：
  首先卸载旧版本（如果有）：
  ```bash
  sudo yum remove docker \
  ```
  安装前置组件：
  sudo yum install -y yum-utils
  添加Docker CE下载仓库（使用官方源）：
  ```bash
  sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
  ```
  安装Docker CE：
  ```bash
  sudo yum install docker-ce
  ```
  按照Docker官方文档，还需要安装docker-ce-cli和containered.io：
  ```bash
  sudo yum install docker-ce-cli containerd.io
  ```

> docker安装镜像：
  ```bash
  docker run -d --restart always -p 1688:1688 pykmsorg/py-kms
  ```
安装完镜像后记得去防火墙\安全组把服务器的1688端口开放。  
如果命令报错请确保docker已经启动。

#### 激活流程
参考Sliamb大佬的文章：[KMS激活Windows/Office口袋指南](https://blog.03k.org/post/kms.html)  

打开终端、Powershell或命令提示符，以此输入以下指令：
经查询，win11专业版的密钥为：`W269N-WFGWX-YVC9B-4J6C9-T83GX`
```shell
slmgr /upk
slmgr /ipk <刚才查询到的许可证密钥>
slmgr /skms <搭建KMS服务的服务器的IP地址，本机则是127.0.0.1>
slmgr /ato
```

![](20230822152838.png)
随后激活就完成了，会有相应提示。如果提示无法联系到服务器，请尝试ping一下服务器，确认是否可以访问。另外，不建议在本机搭建，因为Windows 11在某些情况下，访问本机会有问题。